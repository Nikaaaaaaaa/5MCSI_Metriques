<html>
  <head>
    <meta charset="UTF-8">
    <title>Commits GitHub – Détail complet</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  </head>
  <body>
    <h2 style="text-align:center;">Commits GitHub par auteur et date</h2>
    <p id="total_commits" style="text-align:center; font-weight: bold;"></p>
    <div id="chart_div" style="width: 100%; height: 500px;"></div>

    <script>
      google.charts.load('current', { packages: ['corechart'] });
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        fetch("/commits/")
          .then(response => response.json())
          .then(data => {
            const tableau = new google.visualization.DataTable();
            tableau.addColumn("string", "Date (Auteur)");
            tableau.addColumn("number", "Commits");

            let total = 0;
            data.results.forEach(entry => {
              tableau.addRow([entry.minute, entry.commits]);
              total += entry.commits;
            });

            document.getElementById("total_commits").innerText =
              "Nombre total de commits (tous auteurs) : " + total;

            const options = {
              title: "Commits GitHub avec auteurs et date",
              hAxis: { title: "Date + Auteur", slantedText: true, slantedTextAngle: 45 },
              vAxis: { title: "Commits" },
              legend: "none"
            };

            const chart = new google.visualization.ColumnChart(document.getElementById("chart_div"));
            chart.draw(tableau, options);
          });
      }
    </script>
  </body>
</html>
